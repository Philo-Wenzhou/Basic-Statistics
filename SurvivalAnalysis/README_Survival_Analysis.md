# 生存分析教程

## 教程简介

本教程提供了全面的生存分析学习资源，从基础数学原理到实践应用，包含Kaplan-Meier曲线的精美绘制和Cox比例风险模型的详细分析。本教程使用R语言实现，并利用R自带的数据集进行实例演示。

## 教程内容概述

- **数学基础**：详细讲解生存分析的核心数学概念，包括生存函数、风险函数、累积风险函数等
- **Kaplan-Meier分析**：实现基础和分组KM曲线，并进行精美的可视化定制
- **Cox回归模型**：从简单到复杂，逐步讲解Cox比例风险模型的构建、检验和结果解释
- **高级技术**：介绍时间依变协变量和竞争风险模型等高级生存分析技术

## 所需R包

运行本教程需要安装以下R包：

- **survival**：生存分析的核心包，提供KM估计和Cox回归等功能
- **survminer**：生存分析结果可视化的强大工具
- **ggplot2**：数据可视化的基础包
- **dplyr**：数据处理和操作
- **tidyr**：数据整理和转换

> 注：脚本中已包含自动安装这些包的代码，首次运行时会自动检查并安装缺失的包

## 数据集说明

本教程使用R自带的生存分析数据集：

1. **lung**：包含228名肺癌患者的生存数据，记录了生存时间、状态、性别、年龄等信息
2. **ovarian**：包含26名卵巢癌患者的生存数据
3. **aml**：包含27名急性髓细胞白血病患者的生存数据

## 教程结构

教程脚本`2 Survival Analysis.r`包含以下主要部分：

### 第一部分：生存分析的数学基础
- 生存分析的基本概念介绍
- 生存函数、风险函数等核心数学定义
- 常用分布模型（指数分布、Weibull分布）的数学表达

### 第二部分：R包安装与加载
- 自动检查和安装所需的R包
- 设置中文字体支持
- 定义自定义主题以美化图表

### 第三部分：数据准备
- 加载和预览R自带的生存分析数据集
- 数据预处理（如变量类型转换）

### 第四部分：Kaplan-Meier生存曲线分析
- 创建生存对象和基础KM估计
- 进行分组KM分析（如按性别分组）
- 绘制基础和精美的KM曲线
- 多组比较的KM曲线分析

### 第五部分：Cox比例风险模型分析
- 基础Cox回归模型构建
- 多变量Cox回归分析
- 比例风险假设检验
- 森林图展示Cox回归结果
- 基于模型预测生存概率
- 分层Cox模型介绍

### 第六部分：高级生存分析技术
- 时间依变协变量介绍
- 竞争风险模型概念讲解

### 第七部分：生存分析结果的可视化展示
- 组合多个生存曲线图
- 风险函数可视化

### 第八部分：导出结果
- 自动创建output目录
- 导出KM曲线、Cox回归森林图等结果为PDF文件

## 如何运行教程

1. 确保已安装R语言环境
2. 下载`2 Survival Analysis.r`脚本文件
3. 在RStudio或其他R环境中打开并运行脚本
4. 首次运行时会自动安装所需的R包
5. 运行过程中会显示各种统计结果和可视化图表
6. 所有输出文件将保存到`output`目录中

## 输出文件说明

运行教程后，将在`output`目录中生成以下文件：

- `KM_Curve_Gender.pdf`：不同性别肺癌患者的精美的Kaplan-Meier生存曲线
- `Cox_Forest_Plot.pdf`：多变量Cox回归结果的森林图
- `Combined_Survival_Plots.pdf`：组合多个生存曲线图的综合展示

## 注意事项

- 本教程使用的是R自带的数据集，无需额外下载数据文件
- 为确保中文字体能正常显示，脚本中已包含针对Windows和Unix系统的字体设置
- 如果运行过程中遇到问题，请检查R包是否正确安装

---

作者：Wenxing Yi
日期：2023-11-15
版本：1.0